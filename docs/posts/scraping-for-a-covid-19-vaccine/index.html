<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="shortcut icon" href="https://magamig.github.io/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.min.css">

    <title>Scraping for a COVID-19 Vaccine</title>

    
    <script>if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!== 0){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"magamig",utcoffset:"1"}))};sessionStorage.setItem("_swa","1");</script>

    
    <meta name="google-site-verification" content="oOj7T7YgBib7EQmE1PWwWTP1DmyTTUxA3yTfPPzVf5s" />

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css" integrity="sha384-L+Gq2Cso/Y2x8fX4wausgiZT8z0QPZz7OqPuz4YqAycQJyrJT9NRLpjFBD6zlOia" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.js" integrity="sha384-z64WtjpyrKFsxox9eI4SI8eM9toXdoYeWb5Qh+8PO+eG54Bv9BZqf9xNhlcLf/sA" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true},{left: '\\[', right: '\\]', display: true},{left: '$', right: '$', display: false},{left: '\\(', right: '\\)', display: false}]});"></script>
</head>
<body>
        <div class="container"><header id="banner">
    <h2><a href="https://magamig.github.io/">Miguel Magalhães</a></h2>
    <nav>
        <ul>
            <li>
                <a href="/posts/" title="Posts">Posts</a>
            </li><li>
                <a href="/places/" title="Places">Places</a>
            </li><li>
                <a href="/about/" title="About">About</a>
            </li>
        </ul>
    </nav>
</header>
<main id="content">
<article>
    <header id="post-header">
        <h1>Scraping for a COVID-19 Vaccine</h1><time>
                May 14, 2021
                · France</time></header><div class="info">
<p>ℹ️ <strong>COVID-19 vaccine</strong><br/>
Learn more from the <a href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/covid-19-vaccines" target="_blank">World Health Organization</a>.</p>
</div>
<p>Earlier today, I went to get my first COVID-19 vaccine dose. Although accross the pond it might seem normal for a young person to be getting the vaccine, it&rsquo;s still considered early for continental Europe, in particular France. So how did I get mine?</p>
<p>Firstly, I&rsquo;d like to make it clear that I did not cut in line! The elderly population, health care and other essential workers, or those clinically vulnurable are already vaccinated by now (or have access to a priority queue). Currently, the French goverment is vaccinating by phases using the age as the only criteria, but sometimes people change or cancel their appointments. When these gaps are not filled by the eve of the appointment <strong>and</strong> the vaccine is temperature sensitive, these slots are up for grabs for the non-priority population. The reasoning behind this is that it is better to have someone non-prioritary taking the vaccine, than letting it go to waste (which is true for the Pfizer-BioNTech and Moderna vaccines). <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>In order to make an appointment, you had to visit <a href="https://www.doctolib.fr/" target="_blank">doctolib.fr</a> and search for a vaccination center near you with a vacant time for that same day or day after. However, finding a slot was near to impossible, since it only happened when people cancelled their appointment at the last minute. You could try your luck constantly reloading the page until you got lucky, but there had to be a better way!</p>
<p>When selecting the type of vaccine, I noticed it would send a <code>GET</code> request to the server that would receive the dates you sent with the available slots for those days and <strong>the next available slot</strong>. It should be clear where this is going from now on.</p>
<p><img src="/image/schedule_vaccine_covid.png" alt=""></p>
<p>Within a couple of minutes, I had a fully working <strong><code>Python</code> script</strong> that asked the server every 10 seconds when was the next slot available, until it found a vacancy. Afterwards, it would open the booking website, where I would manually fill out the form. I left it running shy of 2 hours, until <strong>I successfully got my apointment for today!</strong></p>
<pre>
import sys
import time
import webbrowser
import requests
import datetime

found = False
while not found:
    today = datetime.datetime.today()
    try:
        r = requests.get(url = API_URL)
        data = r.json()
        next_slot = datetime.datetime.strptime(data['next_slot'], '%Y-%m-%d')
        print(f'Next slot: {next_slot}')
        if((next_slot - today).days < 1):
            webbrowser.open(URL)
            found = True
        else:
            time.sleep(10)
    except KeyError:
        continue
</pre>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Crommelin, D. J., Anchordoquy, T. J., Volkin, D. B., Jiskoot, W., &amp; Mastrobattista, E. (2021). Addressing the cold reality of mRNA vaccine stability. Journal of Pharmaceutical Sciences, 110(3), 997-1001.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
</article>

            </main><footer id="footer">
    
</footer>
<div>
    </body>
</html>
